<!DOCTYPE html>
<!--[if lt IE 7]>
<html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>
<html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>
<html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" xmlns:th="http://www.thymeleaf.org">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport"/>
    <title>看了星光，爱上星光</title>
    <link rel="stylesheet" th:href="@{/output.css}">
    <link rel="icon" type="image/png" th:href="@{/favicon.png}">
    <style>
        .content_msg {
            position: absolute;
            text-align: center;
            top: 32%;
            width: 100%;
            color: #CCC;
            font-size: 14px;
        }

        .loadClass {
            display: none;
        }
    </style>
</head>
<body class="bg-grey-lighter font-sans antialiased">
<div class="fixed bg-grey-lighter pin z-50 flex justify-center items-center" id="loading">
    <svg width="60px" height="60px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         id="morphing">
        <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
            <g transform="translate(-1178.000000, -87.000000)">
                <g transform="translate(1159.000000, 0.000000)">
                    <g transform="translate(0.000000, 87.000000)">
                        <g transform="translate(19.000000, 0.000000)">
                            <circle id="small-circle" fill="#5661B3" cx="30" cy="30" r="30"></circle>
                            <path id="moon"
                                  d="M30.5,49.7304688 C40.7172679,49.7304688 30.5,43.266096 30.5,33.0488281 C30.5,22.8315603 40.7172679,12 30.5,12 C20.2827321,12 11.0390625,20.6479665 11.0390625,30.8652344 C11.0390625,41.0825022 20.2827321,49.7304688 30.5,49.7304688 Z"
                                  fill="#F4E1E0"></path>
                            <circle id="big-circle" fill="#070707" cx="31" cy="31" r="11"></circle>
                        </g>
                    </g>
                </g>
            </g>
        </g>
    </svg>
</div>
<div th:replace="common/top"></div>
<!-- Main -->
<div class="flex">
    <!-- Side Nav -->
    <div th:replace="common/left"></div>

    <!-- Content -->
    <div class="flex flex-1 flex-col md:px-6 pt-10" id="content">
        <!-- Title -->
        <div class="px-6 md:px-0 flex justify-between items-center -order-1">
            <div>
                <h2 class="font-normal">我的作品与收益</h2>
                <p class="text-grey-dark mt-2">尽量上传吸引人的作品</p>
            </div>
            <button class="bg-indigo-dark hover:bg-indigo-darker text-white text-sm py-2 px-4 rounded-full transition-normal hover:shadow hover:translate-y-1 active:translate-y-1 focus:outline-none"
                    th:if="${login}" onclick="openAddBook()">添加新的数据
            </button>
        </div>
        <!-- Desktop Stats -->
        <div class="hidden px-6 md:px-0 mt-4 md:flex flex-wrap order-1 md:-order-1 md:shadow-md js-tab-pane"
             id="section-stats">
            <div class="p-4 px-6 w-full md:w-1/2 rounded md:rounded-r-none bg-white shadow-md md:shadow-none">
                <h4>你近三个月的收益情况</h4>
                <table class="mt-4 w-full">
                    <thead class="p-2 text-sm leading-loose border-b text-indigo">
                    <tr>
                        <td>Name</td>
                        <td class="text-center">Owned/Wishlist</td>
                        <td class="text-right">Nationality</td>
                    </tr>
                    </thead>
                    <tbody class="p-2 leading-loose text-sm">
                    <tr class="border-b">
                        <td class="py-2">Yohji Yamamoto</td>
                        <td class="py-2 text-center">5/4</td>
                        <td class="py-2 text-right">Japan</td>
                    </tr>
                    <tr class="border-b">
                        <td class="py-2">Sato Oki</td>
                        <td class="py-2 text-center">1/3</td>
                        <td class="py-2 text-right">Japan</td>
                    </tr>
                    <tr>
                        <td class="py-2">Amaya Arzuaga</td>
                        <td class="py-2 text-center">1/1</td>
                        <td class="py-2 text-right">Spain</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="w-full md:w-1/2 p-4 md:pt-12 md:pl-1 mt-4 md:mt-0 lg:pt-12 lg:pl-8 rounded md:rounded-r-none bg-white shadow-md md:shadow-none">
                <div class="flex">
                    <div class="w-1/2">
                        <p class="text-indigo text-sm p-2">Most read format</p>
                        <p class="font-medium text-sm pl-2">Print</p>
                    </div>
                    <div class="w-1/2">
                        <p class="text-indigo text-sm p-2">Total read/own</p>
                        <p class="font-medium text-sm pl-2">4/7</p>
                    </div>
                </div>
                <div class="pt-6">
                    <p class="text-indigo text-sm p-2">Most re-read book</p>
                    <p class="font-medium text-sm pl-2 leading-normal">Just My Type: A Book About Fonts
                        <br><span class="font-normal">by Simon Garfield</span></p>
                </div>
            </div>
        </div>
        <!-- Filter -->
        <div class="px-6 md:px-0 flex items-baseline justify-between border-b-2 border-grey-light mt-6 order-0 lg:order-1">
            <h4 class="hidden md:inline-block text-grey-dark font-normal">Books</h4>
            <div>
                <div class="inline-block md:hidden no-underline border-indigo pb-2 px-2 text-sm mr-2 text-indigo-darkest hover:cursor-pointer js-tab relative"
                     data-tab="section-stats" onclick="clearData()">收益信息
                </div>
                <div th:onclick="'JavaScript:cutType(\''+${dataType.slDataId}+'\')'"
                     th:each="dataType,dataTypeStar:${bookDataType}"
                     th:class="${dataType.slDataName == '漫画'} ? 'no-underline inline-block border-indigo pb-2 px-2 text-sm mr-2 text-indigo-darkest hover:cursor-pointer js-tab relative active' : 'no-underline inline-block border-indigo pb-2 px-2 text-sm mr-2 text-indigo-darkest hover:cursor-pointer js-tab relative'"
                     data-tab="section-library">[[${dataType.slDataName}]]
                    <!--<span class="text-indigo text-xs"></span>-->
                    <input type="hidden" th:value="${dataType.slDataId}"/>
                </div>
                <!--<div class="no-underline inline-block border-indigo pb-2 px-2 text-sm text-indigo-darkest hover:cursor-pointer js-tab relative"
                     data-tab="section-picks">小说
                </div>-->
            </div>
        </div>
        <!-- Library -->
        <div class="px-2 pt-2 md:px-0  order-2 pb-8 "
             style="position: relative; text-align: center; display: none;"
             id="loading_id">
            <span class="content_msg">内容加载中，马上就好...</span>
            <img style="margin: auto;" th:src="@{/loading.gif}">
        </div>
        <div class="hidden px-2 pt-2 md:px-0 flex-wrap order-2 pb-8 js-tab-pane active" id="section-library">


            <div th:if="${not #lists.isEmpty(result.data.indexBooks)}" th:each="ib:${result.data.indexBooks}"
                 th:onclick="'JavaScript:Look(\''+${ib.slBookId}+'\')'"
                 class="flex flex-row sm:flex-col items-center sm:items-start w-full xs:w-1/2 sm:w-1/3 md:w-1/5 p-4 js-book">
                <img style="height: 180px; width: 140px;" th:src="${ib.slCoverImage}" alt="book-01"
                     class="w-1/3 sm:w-full shadow-md transition-normal hover:brighter hover:translate-y-1 hover:shadow-lg hover:border-indigo">
                <div class="ml-3 sm:ml-0 w-2/3 sm:w-full">
                    <p class="text-sm my-2 font-medium sm:font-normal">[[${ib.slBookName}]]</p>
                    <p class="block sm:hidden mt-2 mb-3 text-sm leading-medium"
                       style="max-height: 120px; overflow: hidden;">[[${ib.slContent}]]</p>
                    <label for=""
                           class="hidden sm:inline-block rounded-full libre-bg-grey text-white px-2 py-1/2 text-xs"
                           th:text="${#dates.format(ib.slUpdateTime , 'yyyy-MM-dd HH:mm:ss')}"> ]</label>
                    <div class="block sm:hidden relative">
                        <select class="block appearance-none w-full text-sm bg-white border border-grey-light hover:border-grey pl-3 py-1 pr-8 rounded shadow leading-normal focus:outline-none focus:shadow-outline">
                            <option>Start</option>
                            <option>Loaned</option>
                            <option selected>Finished</option>
                        </select>
                        <div class="pointer-events-none absolute pin-y pin-r flex items-center px-2 text-grey-darker">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg"
                                 viewBox="0 0 20 20">
                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Picks -->
        <div class="hidden flex-wrap order-2 pt-0 md:pt-6 md:pb-8 js-tab-pane" id="section-picks">
            <div class="flex justify-start items-center p-5 px-6 w-full sm:w-1/2" style="background-color:#FBC164;">
                <img src="./images/pick-1.jpg" alt="pick" class="shadow-md w-1/3">
                <div class="ml-4 mt-1 w-2/3">
                    <p class="font-medium">Popeye Jul 2018</p>
                    <p class="mt-3 text-sm">Eu quo donec pellentesque, urna velit. Ultrices ante iaculis ligula
                        praesent</p>
                    <button class="shadow-md mt-3 bg-grey-lightest hover:bg-white text-indigo-darker text-xs py-2 px-4 rounded-full transition-normal hover:shadow hover:translate-y-1 active:translate-y-1 focus:outline-none">
                        Add
                        to Wishlist
                    </button>
                </div>
            </div>
            <div class="flex justify-start items-center p-5 px-6  w-full sm:w-1/2" style="background-color:#F1CECD;">
                <img src="./images/pick-2.jpg" alt="pick" class="shadow-md w-1/3">
                <div class="ml-4 mt-1 w-2/3">
                    <p class="font-medium">Brutus Aug 2018</p>
                    <p class="mt-3 text-sm">Sapien eget, fermentum curabitur quis ut pharetra odio id, vitae eros eget
                        maecenas,
                        ullamcorper vitae.</p>
                    <button class="shadow-md mt-3 bg-grey-lightest hover:bg-white text-indigo-darker text-xs py-2 px-4 rounded-full transition-normal hover:shadow hover:translate-y-1 active:translate-y-1 focus:outline-none">
                        Add
                        to Wishlist
                    </button>
                </div>
            </div>
            <div class="flex justify-start items-center p-5 px-6  w-full sm:w-1/2" style="background-color:#ECE7E9;">
                <img src="./images/pick-3.jpg" alt="pick" class="shadow-md w-1/3">
                <div class="ml-4 mt-1 w-2/3">
                    <p class="font-medium">Casa Aug 2018</p>
                    <p class="mt-3 text-sm">Curabitur quis ut pharetra odio id, vitae eros eget tristique maecenas,
                        ullamcorper
                        vitae.</p>
                    <button class="shadow-md mt-3 bg-grey-lightest hover:bg-white text-indigo-darker text-xs py-2 px-4 rounded-full transition-normal hover:shadow hover:translate-y-1 active:translate-y-1 focus:outline-none">
                        Add
                        to Wishlist
                    </button>
                </div>
            </div>
            <div class="flex justify-start items-center p-5 px-6  w-full sm:w-1/2" style="background-color:#D0E3E8;">
                <img src="./images/pick-4.jpg" alt="pick" class="shadow-md w-1/3">
                <div class="ml-4 mt-1 w-2/3">
                    <p class="font-medium">SUPER: Jul 2018</p>
                    <p class="mt-3 text-sm">Eu quo donec pellentesque, urna velit. Ultrices ante iaculis ligula
                        praesent</p>
                    <button class="shadow-md mt-3 bg-grey-lightest hover:bg-white text-indigo-darker text-xs py-2 px-4 rounded-full transition-normal hover:shadow hover:translate-y-1 active:translate-y-1 focus:outline-none">
                        Add
                        to Wishlist
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Profile -->
    <div class="hidden absolute pin-b z-10 lg:relative lg:block w-full lg:w-1/5 bg-grey-lighter-2 px-6 pt-10"
         id="profile">
        <div class="flex items-center mb-6">
            <svg width="60px" height="60px" viewBox="0 0 60 60" version="1.1" xmlns="http://www.w3.org/2000/svg"
                 xmlns:xlink="http://www.w3.org/1999/xlink"
                 id="avatar">
                <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                    <g transform="translate(-1178.000000, -87.000000)">
                        <g transform="translate(1159.000000, 0.000000)">
                            <g transform="translate(0.000000, 87.000000)">
                                <g transform="translate(19.000000, 0.000000)">
                                    <circle id="small-circle" fill="#5661B3" cx="30" cy="30" r="30"></circle>
                                    <path id="moon"
                                          d="M30.5,49.7304688 C40.7172679,49.7304688 30.5,43.266096 30.5,33.0488281 C30.5,22.8315603 40.7172679,12 30.5,12 C20.2827321,12 11.0390625,20.6479665 11.0390625,30.8652344 C11.0390625,41.0825022 20.2827321,49.7304688 30.5,49.7304688 Z"
                                          fill="#F4E1E0"></path>
                                    <circle id="big-circle" fill="#070707" cx="31" cy="31" r="11"></circle>
                                </g>
                            </g>
                        </g>
                    </g>
                </g>
            </svg>
            <div class="ml-3">
                <p>Amie Chen</p>
                <p class="text-grey-dark mt-1 text-sm">Joined since 2017</p>
            </div>
        </div>
        <div class="my-4 border-t pt-4">
            <h3 class="text-indigo-dark font-normal">你曾经阅读过的数据 </h3>
            <div th:if="${not #lists.isEmpty(result.data.slBooks)}"
                 class="flex flex-wrap -ml-2 justify-start items-center">
                <img style="cursor: pointer;width: 70px;height: 100px;"
                     th:onclick="'JavaScript:Look(\''+${past.slBookId}+'\')'"
                     th:each="past:${result.data.slBooks}"
                     th:src="${past.slCoverImage}" alt="read"
                     class="w-1/6 lg:w-1/5 max-w-tiny shadow-md block m-2 transition-normal hover:brighter">
            </div>
        </div>
        <!-- <div class="mt-6">
            <p class="text-grey-dark mt-1 text-sm">Currently Reading</p>
            <div class="flex items-start mt-2">
                <img src="./images/read-04.jpg" alt="read" class="w-1/6 lg:w-1/5 max-w-tiny shadow-md block transition-normal hover:brighter">
                <div class="ml-3">
                    <p class="mt-1 leading-normal">Popular Lies* About Graphic Design</p>
                    <p class="text-indigo text-sm mt-1">15/250 pages</p>
                </div>
            </div>
        </div> -->
    </div>
</div>
<div class="hidden p-4" id="popup">
    <h3 class="font-medium">Popeye Aug 2018</h3>
    <p class="text-sm mt-2 mb-3">Curabitur quis ut pharetra odio id, vitae eros eget tristique maecenas, ullamcorper
        vitae.</p>
    <div class="relative">
        <select class="block appearance-none w-full text-sm bg-white border border-grey-light hover:border-grey pl-3 py-1 pr-8 rounded shadow leading-normal focus:outline-none focus:shadow-outline"
                id="tippy-select">
            <option>Start</option>
            <option>Loaned</option>
            <option selected>Finished</option>
        </select>
        <div class="pointer-events-none absolute pin-y pin-r flex items-center px-2 text-grey-darker">
            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20">
                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/>
            </svg>
        </div>


    </div>

    <form th:action="@{/}" id="URL"></form>
    <input type="hidden" id="censent" th:value="${USER_CONSENT_REQUEST_KEY}"/>
    <input type="hidden" id="login" th:value="${login}"/>
    <input type="hidden" id="SSO" th:value="${SSO}"/>
    <input type="hidden" id="DATA" th:value="${DATA}"/>
</div>
<script th:src="@{/bundle.js}" async defer></script>
<script th:src="@{/layui/layui.js}"></script>
<script th:src="@{/jquery-1.9.1.min.js}"></script>
<script>
    // 退出账号
    function exitUser() {

        //页面层

        layer.open({
            type: 1,
            skin: 'layui-layer-rim', //加上边框
            area: ['420px', '240px'], //宽高
            closeBtn: 0,
            content: '5秒后自动刷新网页'
        });
        setTimeout(function () {
            location.reload();
        }, 5000)

        $.ajax({
            url: $("#SSO").val() + "/exit",
            type: "GET",
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
            }
        });
    }

    // 切换类型
    function cutType(id) {
        $("#loading_id").stop().fadeIn(100);
        $("#section-library").stop().fadeOut(100);
        setTimeout(function () {
            $.post(
                $("#URL").attr("action") + "getBookByTypeId",
                {"typeId": id}, function (data) {
                    if (data.status == 200) {
                        $(".content_msg").html("正在解析数据，请稍后....");
                        if (data.data == null || data.data.length < 1) {
                            $(".content_msg").html("找不到合适的数据呢...");
                        } else {
                            var html = "";
                            for (var i = 0; i < data.data.length; i++) {
                                html += "<div onclick=\"Look(" + data.data[i].slBookId + ")\"\n" +
                                    "                 class=\"flex flex-row sm:flex-col items-center sm:items-start w-full xs:w-1/2 sm:w-1/3 md:w-1/5 p-4 js-book\">\n" +
                                    "                <img style=\"height: 180px; width: 140px;\" src='" + data.data[i].slCoverImage + "' alt=\"book-01\"\n" +
                                    "                     class=\"w-1/3 sm:w-full shadow-md transition-normal hover:brighter hover:translate-y-1 hover:shadow-lg hover:border-indigo\">\n" +
                                    "                <div class=\"ml-3 sm:ml-0 w-2/3 sm:w-full\">\n" +
                                    "                    <p class=\"text-sm my-2 font-medium sm:font-normal\">" + data.data[i].slBookName + "</p>\n" +
                                    "                    <p class=\"block sm:hidden mt-2 mb-3 text-sm leading-medium\"\n" +
                                    "                       style=\"max-height: 120px; overflow: hidden;\">" + data.data[i].slContent + "</p>\n" +
                                    "                    <label for=\"\"\n" +
                                    "                           class=\"hidden sm:inline-block rounded-full libre-bg-grey text-white px-2 py-1/2 text-xs\"\n" +
                                    "                         > " + data.data[i].slUpdateTime + "</label>\n" +
                                    "                    <div class=\"block sm:hidden relative\">\n" +
                                    "                        <select class=\"block appearance-none w-full text-sm bg-white border border-grey-light hover:border-grey pl-3 py-1 pr-8 rounded shadow leading-normal focus:outline-none focus:shadow-outline\">\n" +
                                    "                            <option>Start</option>\n" +
                                    "                            <option>Loaned</option>\n" +
                                    "                            <option selected>Finished</option>\n" +
                                    "                        </select>\n" +
                                    "                        <div class=\"pointer-events-none absolute pin-y pin-r flex items-center px-2 text-grey-darker\">\n" +
                                    "                            <svg class=\"fill-current h-4 w-4\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\">\n" +
                                    "                                <path d=\"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z\"/>\n" +
                                    "                            </svg>\n" +
                                    "                        </div>\n" +
                                    "                    </div>\n" +
                                    "                </div>\n" +
                                    "            </div>";
                            }

                            $("#section-library").html(html);
                            $("#loading_id").stop().fadeOut(100);
                            $("#section-library").stop().fadeIn(100);
                        }
                    } else {
                        layer.msg(data.msg);
                    }
                }, "json"
            )
        }, 1000)
    }

    function clearData() {
        $("#section-library").stop().fadeOut(100);
    }

    layui.use('layer', function () {
        var layer = layui.layer;
        var censent = $("#censent").val();
        if (censent.trim() != "" && censent == "false" && $("#login").val()) {
            var width = '50%';
            if (document.body.clientWidth < 500) {
                width = '96%';
            }
            var win = layer.open({
                type: 2,
                title: '用户须知',
                shadeClose: false,
                shade: 0.8,
                maxmin: true,
                closeBtn: 0,
                area: ['414px', '600px'],
                scrollbar: false,
                content: $("#URL").attr("action") + 'mustKnow' //iframe的url
            });
            if (width == "96%") {
                layer.full(win);
            }
        }

    });

    function openAddBook() {
        var width = '50%';
        if (document.body.clientWidth < 500) {
            width = '96%';
        }
        layer.open({
            type: 2,
            title: '添加新书本',
            shadeClose: false,
            shade: 0.8,
            area: [width, '95%'],
            scrollbar: false,
            content: $("#URL").attr("action") + 'show/book' //iframe的url
        });
    }

    function Look(id) {
        var width = '50%';
        if (document.body.clientWidth < 500) {
            width = '96%';
        }
        var win = layer.open({
            type: 2,
            title: '书本名称',
            shadeClose: true,
            shade: 0.8,
            maxmin: true,
            area: [width, '600px'],
            scrollbar: false,
            content: $("#URL").attr("action") + 'book/content?bookId=' + id //iframe的url
        });
        if (width == "96%") {
            layer.full(win);
        }
    }

</script>
</body>
</html>
